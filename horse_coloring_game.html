<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>小馬著色遊戲</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            touch-action: none; /* 禁用瀏覽器預設的觸控行為，如滾動 */
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            background-color: #f0f0f0;
        }
        /* 畫布容器，背景是馬的線稿 */
        #canvas-container {
            width: 680px;
            height: 680px;
            position: relative;
            background-image: url('./horse-outline.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px solid #ccc;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        /* 畫布本身，絕對定位疊在容器之上 */
        #drawing-canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
        }
        /* 工具列按鈕的樣式 */
        .tool-btn {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        .tool-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
            border-color: #fff;
        }
    </style>
</head>
<body class="bg-gray-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div id="root"></div>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CANVAS_WIDTH = 680;
        const CANVAS_HEIGHT = 680;

        const App = () => {
            const canvasRef = useRef(null);
            const audioRef = useRef(null);
            const isDrawingRef = useRef(false);
            
            const [color, setColor] = useState('#ff0000'); // 預設紅色
            const [brushSize, setBrushSize] = useState(10); // 預設大小

            // 初始化畫布
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
            }, []);

            // 當顏色或筆刷大小改變時更新畫布設定
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.strokeStyle = color;
                ctx.lineWidth = brushSize;
            }, [color, brushSize]);

            // 取得相對於畫布的座標
            const getCoords = (e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                if (e.touches) { // 觸控事件
                    return {
                        x: e.touches[0].clientX - rect.left,
                        y: e.touches[0].clientY - rect.top,
                    };
                }
                // 滑鼠事件
                return { x: e.clientX - rect.left, y: e.clientY - rect.top };
            };

            const startDrawing = (e) => {
                const ctx = canvasRef.current.getContext('2d');
                const { x, y } = getCoords(e);
                ctx.beginPath();
                ctx.moveTo(x, y);
                isDrawingRef.current = true;
                
                // 嘗試在開始繪畫時就播放一次，以解鎖音訊
                if(audioRef.current && audioRef.current.paused) {
                    audioRef.current.play().catch(err => {
                        console.log("音訊需要使用者互動才能播放。");
                    });
                }
            };

            const draw = (e) => {
                if (!isDrawingRef.current) return;
                const ctx = canvasRef.current.getContext('2d');
                const { x, y } = getCoords(e);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // 播放聲音
                if(audioRef.current) {
                    audioRef.current.currentTime = 0;
                    audioRef.current.play().catch(err => {});
                }
            };

            const stopDrawing = () => {
                isDrawingRef.current = false;
            };

            const clearCanvas = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            };
            
            const colors = ['#ff0000', '#0000ff', '#00ff00', '#ffff00', '#ff00ff', '#00ffff', '#000000', '#ffffff'];
            const sizes = [5, 10, 20, 30, 50];

            return (
                <div className="flex flex-col items-center gap-4">
                    <h1 className="text-3xl font-bold text-white">自由畫小馬</h1>
                    
                    {/* --- 工具列 --- */}
                    <div className="bg-gray-700 p-3 rounded-lg flex flex-wrap items-center justify-center gap-4 shadow-lg">
                        <div className="flex items-center gap-3">
                            <span className="text-white font-semibold">顏色:</span>
                            {colors.map(c => (
                                <button 
                                    key={c}
                                    onClick={() => setColor(c)}
                                    className={`tool-btn w-10 h-10 rounded-full ${color === c ? 'selected' : ''}`}
                                    style={{ backgroundColor: c }}
                                />
                            ))}
                        </div>
                        <div className="w-px h-10 bg-gray-500 mx-2"></div>
                        <div className="flex items-center gap-3">
                            <span className="text-white font-semibold">粗細:</span>
                            {sizes.map(s => (
                                <button 
                                    key={s}
                                    onClick={() => setBrushSize(s)}
                                    className={`tool-btn bg-gray-600 w-10 h-10 rounded-full flex items-center justify-center ${brushSize === s ? 'selected' : ''}`}
                                >
                                    <div className="bg-white rounded-full" style={{width: s, height: s}}></div>
                                </button>
                            ))}
                        </div>
                        <div className="w-px h-10 bg-gray-500 mx-2"></div>
                        <button onClick={clearCanvas} className="bg-red-600 text-white font-bold px-6 py-2 rounded-lg hover:bg-red-500 transition-colors">
                            全部清除
                        </button>
                    </div>

                    {/* --- 畫布區域 --- */}
                    <div id="canvas-container">
                        <canvas
                            id="drawing-canvas"
                            ref={canvasRef}
                            width={CANVAS_WIDTH}
                            height={CANVAS_HEIGHT}
                            onMouseDown={startDrawing}
                            onMouseMove={draw}
                            onMouseUp={stopDrawing}
                            onMouseLeave={stopDrawing}
                            onTouchStart={startDrawing}
                            onTouchMove={draw}
                            onTouchEnd={stopDrawing}
                        />
                    </div>
                    {/* --- 音效來源已改回 draw_sound.mp3 --- */}
                    <audio ref={audioRef} src="./draw_sound.mp3" className="hidden" />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
